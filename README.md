# 🚚 司机配送成本分析系统

基于GPS打卡数据的智能配送成本分析和可视化系统。

## ✨ 主要功能

### 1. 📍 配送路径可视化
- **交互式地图展示**：显示司机配送路径、仓库位置、配送点
- **多司机对比**：支持同时显示多个司机的配送轨迹
- **分公司筛选**：按分公司查看司机配送情况
- **路径颜色编码**：不同司机使用不同颜色区分

### 2. 📊 成本分析报表
- **实时成本计算**：基于可配置参数实时计算配送成本
- **多维度分析**：里程成本、时间成本、固定成本三维分解
- **分公司对比**：各分公司配送效率和成本对比
- **司机绩效**：单个司机配送绩效分析

### 3. ⚙️ 参数实时调整
- **燃油单价**：7.5元/升（可调范围：6.0-10.0）
- **百公里油耗**：8.0升（可调范围：6.0-12.0）
- **过路费率**：0.45元/公里（可调范围：0.2-0.8）
- **司机时薪**：25元/小时（可调范围：15-40）
- **车辆日折旧**：150元（可调范围：100-300）
- **日保险费**：50元（可调范围：30-100）

## 🛠️ 安装和使用

### 环境要求
- Python 3.8+
- 建议使用虚拟环境

### 1. 克隆项目
```bash
git clone <your-repo-url>
cd tariff
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 准备数据
确保以下数据文件存在：
- `data/2025-08-20_打卡_已匹配.csv` - 司机打卡数据
- `data/2025-08-20_司机成本分析.csv` - 成本分析结果
- `data/2025-08-20_分公司汇总.csv` - 分公司汇总数据

### 4. 启动应用

#### 方法一：使用启动脚本（推荐）
```bash
python run_app.py
```

#### 方法二：直接运行Streamlit
```bash
streamlit run streamlit_app.py
```

### 5. 访问应用
应用启动后会自动打开浏览器，或手动访问：
```
http://localhost:8501
```

## 📋 使用说明

### 配送路径地图页面
1. **选择司机**：在多选框中选择要查看的司机
2. **分公司筛选**：选择特定分公司查看其司机
3. **查看路径**：地图上会显示：
   - 🏠 黑色图标：仓库位置
   - 🔴 彩色圆点：配送点
   - 📍 彩色线条：配送路径

### 成本分析报表页面
1. **关键指标**：顶部显示总体统计数据
2. **可视化图表**：
   - 成本结构饼图
   - 分公司效率对比
   - 司机绩效散点图
   - 成本对比柱状图

### 参数调整
1. **左侧边栏**：拖动滑块调整成本参数
2. **实时计算**：参数改变时自动重新计算成本
3. **对比显示**：显示参数调整前后的成本变化

## 📁 项目结构

```
tariff/
├── streamlit_app.py              # Streamlit主应用
├── delivery_cost_calculator.py   # 成本计算核心模块
├── cost_analysis_report.py      # 报表生成模块
├── run_app.py                   # 启动脚本
├── requirements.txt             # 依赖包列表
├── CLAUDE.md                   # 开发指南
├── README.md                   # 使用说明
├── data/                       # 数据目录
│   ├── 2025-08-20_打卡_已匹配.csv
│   ├── 2025-08-20_司机成本分析.csv
│   ├── 2025-08-20_分公司汇总.csv
│   ├── cost_parameters.json
│   └── reports/               # 生成的报告
│       ├── 配送成本分析报告.md
│       ├── 成本结构分析.png
│       └── 分公司对比分析.png
└── plan_cc.md                 # 项目规划文档
```

## 🔧 技术栈

- **后端处理**：Python + pandas + numpy
- **Web框架**：Streamlit
- **地图可视化**：Folium + streamlit-folium
- **图表可视化**：Plotly
- **距离计算**：Haversine公式（可扩展为高德API）

## 📈 核心算法

### 成本计算公式
```
总配送成本 = 里程成本 + 时间成本 + 固定成本

里程成本 = 实际行驶距离 × (燃油单价 × 百公里油耗/100 + 过路费率)
时间成本 = 配送时长 × 司机时薪
固定成本 = 车辆折旧 + 保险费用
```

### 路径重建算法
1. **起点识别**：使用匹配的分公司仓库坐标
2. **时间排序**：按打卡时间构建配送序列
3. **距离计算**：使用Haversine公式计算直线距离
4. **成本分摊**：按配送点数量分摊固定成本

## 🚀 扩展计划

1. **高德API集成**：替换直线距离为真实路径距离
2. **历史数据分析**：支持多日期数据对比分析
3. **路径优化建议**：基于AI算法提供路径优化建议
4. **移动端适配**：响应式设计支持移动设备访问

## 📞 技术支持

如有问题请查看：
- 项目文档：`CLAUDE.md`
- 规划文档：`plan_cc.md`
- 生成报告：`data/reports/配送成本分析报告.md`

## 📄 许可证

本项目仅用于内部配送成本分析，请勿用于商业用途。