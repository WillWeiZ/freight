# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

这是一个司机送货成本分析系统，通过分析司机GPS打卡数据，结合高德API计算真实行驶距离，实现精准的配送成本核算。

## 数据结构

### 核心数据文件
- `data/扫码拍照数据表*.csv` - 原始司机GPS打卡数据
- `data/ship_to.csv` - 分公司配送地址信息（Tab分隔）
- `data/*_打卡.csv` - 按日期筛选的打卡数据
- `data/*_打卡_已匹配.csv` - 匹配分公司信息后的最终数据

### 关键字段映射
- `微信open_id` - 司机唯一标识符
- `提交时间` - GPS打卡时间戳，格式：YYYY-MM-DD HH:MM:SS
- `经度/纬度` - GPS坐标，用于路径计算
- `送货地址` - 实际配送地址
- `收货方名称/收货方编码` - 门店标识信息
- `Hub Name` - 分公司名称（格式：公司名-地区名）

## 常用开发命令

### 数据处理
```python
# 读取原始数据（文件较大，需要分批处理）
import pandas as pd
df = pd.read_csv('data/扫码拍照数据表*.csv')

# 按日期统计打卡次数
df['提交日期'] = pd.to_datetime(df['提交时间']).dt.date
date_counts = df['提交日期'].value_counts()
```

### 智能地址匹配
项目包含智能匹配算法，通过地名关键词匹配分公司与送货地址：
- 关键词：赣州、章贡、永州、冷水滩、株洲、吉安、衡阳、郴州、北湖
- 匹配逻辑基于地址字符串包含分公司地区名称

## 项目架构

### 核心功能模块
1. **数据预处理模块** - CSV读取、清洗、格式化
2. **司机轨迹分析模块** - 路径重建和起点识别
3. **成本计算模块** - 结合高德API的距离计算
4. **地址匹配模块** - 智能匹配分公司与配送地址

### 起点识别算法权重
- 时间分析法（当日首次打卡）：40%
- 频率分析法（多日重复位置）：35%
- 地址关键词匹配：15%
- GPS坐标聚类：10%

### 数据处理流程
1. 导入CSV数据，指定编码为utf-8-sig
2. 坐标标准化和异常值处理
3. 按司机+日期聚合，构建站点序列
4. 调用高德API计算路径距离
5. 生成成本分析报告

## 文件组织
- `/data/` - 所有数据文件存储目录
- `plan.md` - 项目整体规划文档
- `plan_cc.md` - 详细实施计划文档

## API集成
项目设计使用高德地图API进行路径规划：
- 端点：`https://restapi.amap.com/v3/direction/driving`
- 参数：origin（起点经纬度）、destination（终点经纬度）
- 返回：行驶距离、预估时间等路径信息

## 开发注意事项
- 处理大型CSV文件时使用分批读取或限制行数
- GPS坐标数据需要异常值检测（>200km距离变化）
- 时间字段需要时区处理和标准化
- 地址匹配支持模糊匹配和关键词提取